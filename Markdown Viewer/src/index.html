<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Markdown Viewer</title>
    <link rel="icon" type="image/x-icon" href="favicons/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="favicons/favicon.svg">
    <link rel="icon" type="image/png" sizes="96x96" href="favicons/favicon-96x96.png">
    <link rel="apple-touch-icon" href="favicons/apple-touch-icon.png">
    <link rel="manifest" href="favicons/site.webmanifest">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </head>

  <body>
    <!-- Load splash screen component first -->
    <script src="/splash-component.js"></script>

    <div class="app">
      <!-- Toolbar -->
      <div class="toolbar">
        <div class="toolbar-left">
          <button id="new-btn" class="toolbar-btn">📄 New</button>
          <button id="open-btn" class="toolbar-btn">📁 Open</button>
          <div class="dropdown-container">
            <button id="save-btn" class="toolbar-btn dropdown-main">💾 Save</button>
            <button id="save-dropdown-arrow" class="toolbar-btn dropdown-arrow">▼</button>
            <div id="save-dropdown-menu" class="dropdown-menu">
              <button id="save-as-btn" class="dropdown-item">Save As</button>
            </div>
          </div>
          <button id="close-btn" class="toolbar-btn">❌ Close</button>
        </div>
        <div class="toolbar-center">
          <button id="code-btn" class="mode-btn">Code</button>
          <button id="preview-btn" class="mode-btn active">Preview</button>
          <button id="split-btn" class="mode-btn">Split</button>
        </div>
        <div class="toolbar-right">
          <div class="dropdown-container">
            <button id="export-btn" class="toolbar-btn dropdown-toggle">Export ▼</button>
            <div id="export-dropdown-menu" class="dropdown-menu">
              <button id="export-html-btn" class="dropdown-item">HTML</button>
              <button id="export-pdf-btn" class="dropdown-item">PDF</button>
            </div>
          </div>
          <button id="distraction-btn" class="toolbar-btn">☐</button>
          <button id="theme-btn" class="toolbar-btn">🌙</button>
        </div>
      </div>

      <!-- Markdown Toolbar -->
      <div id="markdown-toolbar" class="markdown-toolbar">
        <div class="toolbar-content">
          <div class="toolbar-group">
            <button id="undo-btn" class="md-btn" title="Undo (Ctrl+Z)">↶</button>
            <button id="redo-btn" class="md-btn" title="Redo (Ctrl+Y)">↷</button>
          </div>
          <div class="toolbar-separator"></div>
          <div class="toolbar-group">
            <button class="md-btn" data-action="h1" title="Heading 1 (Ctrl+1)">H1</button>
            <button class="md-btn" data-action="h2" title="Heading 2 (Ctrl+2)">H2</button>
            <button class="md-btn" data-action="h3" title="Heading 3 (Ctrl+3)">H3</button>
          </div>
          <div class="toolbar-separator"></div>
          <div class="toolbar-group">
            <button class="md-btn" data-action="bold" title="Bold (Ctrl+B)"><strong>B</strong></button>
            <button class="md-btn" data-action="italic" title="Italic (Ctrl+I)"><em>I</em></button>
            <button class="md-btn" data-action="underline" title="Underline (Ctrl+Shift+U)"><u>U</u></button>
            <button class="md-btn" data-action="strikethrough" title="Strikethrough"><s>S</s></button>
          </div>
          <div class="toolbar-separator"></div>
          <div class="toolbar-group">
            <button class="md-btn" data-action="link" title="Link (Ctrl+K)">🔗</button>
            <button class="md-btn" data-action="image" title="Image">🖼️</button>
            <button class="md-btn" data-action="code" title="Inline Code">💻</button>
          </div>
          <div class="toolbar-separator"></div>
          <div class="toolbar-group">
            <button class="md-btn" data-action="ul" title="Unordered List">• List</button>
            <button class="md-btn" data-action="ol" title="Ordered List">1. List</button>
            <button class="md-btn" data-action="task" title="Task List">☐ Task</button>
          </div>
          <div class="toolbar-separator"></div>
          <div class="toolbar-group">
            <button class="md-btn" data-action="table" title="Table">📊</button>
            <button class="md-btn" data-action="hr" title="Horizontal Rule">―</button>
            <button class="md-btn" data-action="quote" title="Blockquote">❝</button>
          </div>
          <div class="toolbar-separator"></div>
          <div class="toolbar-group font-size-group">
            <button id="font-size-decrease" class="md-btn font-btn" title="Decrease Font Size">A-</button>
            <span id="font-size-display" class="font-size-display">14px</span>
            <button id="font-size-increase" class="md-btn font-btn" title="Increase Font Size">A+</button>
          </div>


        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Editor Pane -->
        <div class="editor-pane">
          <div id="monaco-editor" class="monaco-editor-container"></div>
          <textarea id="editor" style="display: none;" placeholder="# Welcome to Markdown Viewer\n\nStart typing your markdown here..."></textarea>
        </div>
        
        <!-- Splitter -->
        <div id="splitter" class="splitter"></div>
        
        <!-- Preview Pane -->
        <div class="preview-pane">
          <div id="welcome-page" class="welcome-page">
            <div class="welcome-content">
              <h1><img src="assets/icon.svg" alt="" class="favicon-icon"> Markdown Editor</h1>
              <p class="welcome-subtitle">A powerful native markdown editor with live preview</p>
              
              <div class="welcome-actions">
                <button id="welcome-new-btn" class="welcome-btn primary">📄 Create New File</button>
                <button id="welcome-open-btn" class="welcome-btn">📁 Open Existing File</button>
              </div>
              
              <div id="file-history-section" class="file-history" style="display: none;">
                <h3>Recent Files</h3>
                <div id="file-history-list" class="file-history-list"></div>
                <button id="clear-history-btn" class="welcome-btn clear-btn">🗑️ Clear History</button>
              </div>
              
              <div class="welcome-actions-grid">
                <h3>Quick Actions</h3>
                <div class="action-buttons">
                  <button id="welcome-help-btn" class="welcome-btn action-btn">Help & Shortcuts</button>
                  <button id="welcome-about-btn" class="welcome-btn action-btn">About</button>
                  <button id="welcome-settings-btn" class="welcome-btn action-btn">Settings</button>
                </div>
              </div>
            </div>
          </div>
          <div id="preview" class="preview-content" style="display: none;">
            <h1>Welcome to Markdown Viewer</h1>
            <p>Start typing your markdown here...</p>
          </div>
        </div>
      </div>

      <!-- Status Bar -->
      <div class="status-bar">
        <div class="status-left">
          <span id="cursor-pos">Line 1, Col 1</span>
        </div>
        <div class="status-center">
          <button id="help-status-btn" class="status-btn" title="Help (F1)">Help</button>
          <div id="zoom-controls" class="zoom-controls" style="display: none;">
            <button id="zoom-out" class="status-btn zoom-btn" title="Zoom Out (Ctrl+-)">🔍-</button>
            <span id="zoom-display" class="zoom-display">100%</span>
            <button id="zoom-in" class="status-btn zoom-btn" title="Zoom In (Ctrl+=)">🔍+</button>
            <button id="zoom-reset" class="status-btn zoom-btn" title="Reset Zoom (Ctrl+0)">Reset</button>
          </div>
        </div>
        <div class="status-right">
          <span id="filename">untitled.md</span>
        </div>
      </div>

      <!-- Enhanced Settings Modal -->
      <div id="settings-modal" class="settings-modal" style="display: none;">
        <div class="settings-overlay"></div>
        <div class="settings-window">
          <div class="settings-header">
            <h2>Settings</h2>
            <button id="settings-close-btn" class="settings-close-btn">×</button>
          </div>
          <div class="settings-content">
            <div class="settings-section">
              <h3>Appearance</h3>
              <div class="setting-item">
                <label>Theme</label>
                <div class="setting-control">
                  <button id="theme-light-btn" class="setting-btn">Light</button>
                  <button id="theme-dark-btn" class="setting-btn">Dark</button>
                </div>
              </div>
            </div>
            
            <div class="settings-section">
              <h3>Editor</h3>
              <div class="setting-item">
                <label>Default Mode</label>
                <div class="setting-control">
                  <button id="mode-code-btn" class="setting-btn">Code</button>
                  <button id="mode-preview-btn" class="setting-btn">Preview</button>
                  <button id="mode-split-btn" class="setting-btn">Split</button>
                </div>
              </div>
              <div class="setting-item">
                <label>Text Suggestions</label>
                <div class="setting-control">
                  <button id="suggestions-on-btn" class="setting-btn">Enabled</button>
                  <button id="suggestions-off-btn" class="setting-btn">Disabled</button>
                </div>
              </div>

              <div class="setting-item">
                <label>Markdown Toolbar</label>
                <div class="setting-control">
                  <button id="toolbar-on-btn" class="setting-btn">Enabled</button>
                  <button id="toolbar-off-btn" class="setting-btn">Disabled</button>
                </div>
              </div>
              <div class="setting-item">
                <label>Splash Screen</label>
                <div class="setting-control">
                  <button id="splash-on-btn" class="setting-btn">Enabled</button>
                  <button id="splash-off-btn" class="setting-btn">Disabled</button>
                </div>
              </div>
              <div class="setting-item" id="splash-duration-setting">
                <label>Splash Duration (seconds)</label>
                <div class="setting-control">
                  <button id="splash-1s-btn" class="setting-btn">1</button>
                  <button id="splash-2s-btn" class="setting-btn">2</button>
                  <button id="splash-3s-btn" class="setting-btn">3</button>
                  <button id="splash-4s-btn" class="setting-btn">4</button>
                  <button id="splash-5s-btn" class="setting-btn">5</button>
                </div>
              </div>
            </div>
            
            <div class="settings-section">
              <h3>Interface</h3>
              <div class="setting-item">
                <label>Main Toolbar Size</label>
                <div class="setting-control">
                  <button id="main-toolbar-small" class="setting-btn">Small</button>
                  <button id="main-toolbar-medium" class="setting-btn">Medium</button>
                  <button id="main-toolbar-large" class="setting-btn">Large</button>
                </div>
              </div>
              <div class="setting-item">
                <label>Markdown Toolbar Size</label>
                <div class="setting-control">
                  <button id="md-toolbar-small" class="setting-btn">Small</button>
                  <button id="md-toolbar-medium" class="setting-btn">Medium</button>
                  <button id="md-toolbar-large" class="setting-btn">Large</button>
                </div>
              </div>
            </div>
            
            <div class="settings-section">
              <h3>Layout</h3>
              <div class="setting-item">
                <label>Centered Layout</label>
                <div class="setting-control">
                  <button id="layout-on-btn" class="setting-btn">Enabled</button>
                  <button id="layout-off-btn" class="setting-btn">Disabled</button>
                </div>
              </div>
              <div class="setting-item">
                <label>Page Size</label>
                <div class="setting-control">
                  <button id="page-a4-btn" class="setting-btn">A4</button>
                  <button id="page-letter-btn" class="setting-btn">Letter</button>
                  <button id="page-a3-btn" class="setting-btn">A3</button>
                </div>
              </div>
            </div>
            
            <div class="settings-section">
              <h3>System Info</h3>
              <div class="system-info">
                <div class="info-item">
                  <span class="info-label">Default Mode:</span>
                  <span id="info-default-mode">Preview</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Current Mode:</span>
                  <span id="info-current-mode">Preview</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Monaco Editor:</span>
                  <span id="info-monaco">Loaded</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Mermaid:</span>
                  <span id="info-mermaid">Loaded</span>
                </div>
                <div class="info-item">
                  <span class="info-label">KaTeX:</span>
                  <span id="info-katex">Loaded</span>
                </div>
              </div>
            </div>
            
            <div class="settings-section">
              <h3>Performance</h3>
              <div class="system-info">
                <div class="info-item">
                  <span class="info-label">Startup Time:</span>
                  <span id="perf-startup">0ms</span>
                </div>
                <div class="info-item">
                  <span class="info-label">File Open Time:</span>
                  <span id="perf-file-open">0ms</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Mode Switch Time:</span>
                  <span id="perf-mode-switch">0ms</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Preview Update Time:</span>
                  <span id="perf-preview-update">0ms</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Memory Usage:</span>
                  <span id="perf-memory">N/A</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Update Count:</span>
                  <span id="perf-update-count">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Help Modal -->
      <div id="help-modal" class="help-modal" style="display: none;">
        <div class="help-overlay"></div>
        <div class="help-window">
          <div class="help-header">
            <h2>📖 Help & Shortcuts</h2>
            <button id="help-close-btn" class="help-close-btn">×</button>
          </div>
          <div class="help-content">
            <div class="help-section">
              <h3>File Operations</h3>
              <div class="shortcut-list">
                <div class="shortcut-item"><kbd>Ctrl+N</kbd><span>New file</span></div>
                <div class="shortcut-item"><kbd>Ctrl+O</kbd><span>Open file</span></div>
                <div class="shortcut-item"><kbd>Ctrl+S</kbd><span>Save file</span></div>
                <div class="shortcut-item"><kbd>Ctrl+Shift+S</kbd><span>Save as</span></div>
                <div class="shortcut-item"><kbd>Ctrl+W</kbd><span>Close file</span></div>
                <div class="shortcut-item"><kbd>Ctrl+Q</kbd><span>Quit application</span></div>
              </div>
            </div>
            
            <div class="help-section">
              <h3>View Modes</h3>
              <div class="shortcut-list">
                <div class="shortcut-item"><kbd>Ctrl+1</kbd><span>Code mode</span></div>
                <div class="shortcut-item"><kbd>Ctrl+2</kbd><span>Preview mode</span></div>
                <div class="shortcut-item"><kbd>Ctrl+3</kbd><span>Split mode</span></div>
                <div class="shortcut-item"><kbd>F11</kbd><span>Fullscreen mode</span></div>
                <div class="shortcut-item"><kbd>Shift+F11</kbd><span>Distraction-free mode</span></div>
                <div class="shortcut-item"><kbd>Esc</kbd><span>Exit distraction-free</span></div>
              </div>
            </div>
            
            <div class="help-section">
              <h3>Editor Shortcuts</h3>
              <div class="shortcut-list">
                <div class="shortcut-item"><kbd>Ctrl+B</kbd><span>Bold text</span></div>
                <div class="shortcut-item"><kbd>Ctrl+I</kbd><span>Italic text</span></div>
                <div class="shortcut-item"><kbd>Ctrl+Shift+1-3</kbd><span>Headers H1-H3</span></div>
                <div class="shortcut-item"><kbd>Ctrl+Shift+M</kbd><span>Toggle toolbar</span></div>
                <div class="shortcut-item"><kbd>Ctrl+F</kbd><span>Find</span></div>
                <div class="shortcut-item"><kbd>Ctrl+Shift+H</kbd><span>Find & replace</span></div>
              </div>
            </div>
            
            <div class="help-section">
              <h3>Export & Print</h3>
              <div class="shortcut-list">
                <div class="shortcut-item"><kbd>Ctrl+Shift+E</kbd><span>Export to HTML</span></div>
                <div class="shortcut-item"><kbd>Ctrl+P</kbd><span>Print/Export PDF</span></div>
                <div class="shortcut-item"><kbd>Ctrl+=</kbd><span>Zoom in (Preview)</span></div>
                <div class="shortcut-item"><kbd>Ctrl+-</kbd><span>Zoom out (Preview)</span></div>
                <div class="shortcut-item"><kbd>Ctrl+0</kbd><span>Reset zoom (Preview)</span></div>
              </div>
            </div>
            
            <div class="help-section">
              <h3>Application</h3>
              <div class="shortcut-list">
                <div class="shortcut-item"><kbd>Ctrl+T</kbd><span>Toggle theme</span></div>
                <div class="shortcut-item"><kbd>Ctrl+,</kbd><span>Settings</span></div>
                <div class="shortcut-item"><kbd>F1</kbd><span>This help</span></div>
                <div class="shortcut-item"><kbd>F5</kbd><span>Refresh preview</span></div>
              </div>
            </div>
            
            <div class="help-tips">
              <h3>💡 Tips</h3>
              <ul>
                <li>Drag & drop .md files to open them</li>
                <li>Drag files in Code mode to insert paths</li>
                <li>Use markdown toolbar for quick formatting</li>
                <li>Click task list checkboxes to toggle them</li>
                <li>Math expressions: $inline$ and $$display$$</li>
                <li>Mermaid diagrams in ```mermaid code blocks</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- About Modal -->
      <div id="about-modal" class="about-modal" style="display: none;">
        <div class="about-overlay"></div>
        <div class="about-window">
          <div class="about-header">
            <h2>About Markdown Editor</h2>
            <button id="about-close-btn" class="about-close-btn">×</button>
          </div>
          <div class="about-content">
            <div class="about-logo">
              <img src="assets/MarkdownEditorAboutImage.png" alt="Markdown Editor" class="about-image">
              <p class="version">Version 2.1.2</p>
            </div>
            
            <div class="about-description">
              <p>A powerful native desktop markdown viewer and editor built with Tauri + Rust + TypeScript.</p>
            </div>
            
            <div class="about-features">
              <h3>Key Features</h3>
              <ul>
                <li>Three-mode interface (Code, Preview, Split)</li>
                <li>Monaco Editor with syntax highlighting</li>
                <li>Real-time preview with KaTeX math and Mermaid diagrams</li>
                <li>Interactive task lists with state persistence</li>
                <li>GitHub-style themes and export options</li>
                <li>Native file operations and drag-drop support</li>
              </ul>
            </div>
            
            <div class="about-credits">
              <h3>Built With</h3>
              <div class="credits-grid">
                <div class="credit-item">
                  <strong>Tauri</strong> - Native app framework
                </div>
                <div class="credit-item">
                  <strong>Monaco Editor</strong> - Code editor
                </div>
                <div class="credit-item">
                  <strong>Marked.js</strong> - Markdown parser
                </div>
                <div class="credit-item">
                  <strong>KaTeX</strong> - Math rendering
                </div>
                <div class="credit-item">
                  <strong>Mermaid</strong> - Diagram rendering
                </div>
                <div class="credit-item">
                  <strong>Highlight.js</strong> - Syntax highlighting
                </div>
              </div>
            </div>
            
            <div class="about-links">
              <h3>Links & Support</h3>
              <div class="link-info">
                <p><a href="https://github.com/travelingbear/markdown-editor" target="_blank">📚 Documentation/Issues</a></p>
                <p><a href="https://buymeacoffee.com/travelingbear" target="_blank">☕ Buy me a coffee</a></p>
              </div>
            </div>
            
            <div class="about-footer">
              <p>&copy; 2025 Markdown Editor. Licensed under MIT License.</p>
            </div>
          </div>
        </div>
      </div>

    </div>
    
    <!-- Load performance optimizer -->
    <script src="/performance-optimizer.js"></script>
    
    <!-- Load main application -->
    <script src="/main.js"></script>
  </body>
</html>
